#!/usr/bin/env sh

# The directory of this repository
current_directory=$(CDPATH= cd -- "$( dirname -- "$0")" && pwd)

# Do a full system upgrade before starting the install script
echo "Doing a full system upgrade before starting the installation..."
sudo pacman -Syyu

# Install packages required to run this script
required_packages="${CDIR}/etc/required.txt"
if [ -s "$required_packages" ]; then
    sudo pacman -S --needed - < "$required_packages"
fi

# Make sure XDG Base Directory Specification is used
XDG_CONFIG_HOME="${HOME}/.config"
XDG_CACHE_HOME="${HOME}/.cache"
XDG_DATA_HOME="${HOME}/.local/share"
XDG_STATE_HOME="${HOME}/.local/state"

# Create important directories
mkdir -vp "${XDG_CONFIG_HOME}"
mkdir -vp "${XDG_CACHE_HOME}"
mkdir -vp "${XDG_DATA_HOME}"
mkdir -vp "${XDG_STATE_HOME}"

mkdir -vp "${HOME}/.local/bin"

# Symlink files to their respective location under $HOME

# Use stow to do most of this work
echo "Symlinking files with stow..."
stow --verbose=2 --dir "${current_directory}" --target "${HOME}"

# Download paru (https://aur.archlinux.org/packages/paru) so packages from the AUR can be installed.
# $current_directory/setup-scripts/paru.sh

# Download themes for Spicetify
# TODO: add as submodule
# $current_directory/setup-scripts/spicetify_themes.sh

# sudo ln -sf $current_directory/etc/unlock-conservation-mode.service /etc/systemd/system/
# sudo systemctl enable unlock-conservation-mode

